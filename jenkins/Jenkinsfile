#!groovy

// утилиты
def checkDirectoryChanges(path) {
    try {
        sh "git diff --quiet --exit-code HEAD~1..HEAD ${path}/"
        echo 'Без сборки так как в директории нет изменений'
        return false
    } catch (err) {
        return true
    }
}

properties(
    [
        disableConcurrentBuilds(),
        pipelineTriggers([cron('* * * * *')]),
        buildDiscarder(
            logRotator(
                numToKeepStr: '10',
                artifactNumToKeepStr: '10'
            )
        ),

    ]
)

node {
    stage('Build_backend') {
        if (checkDirectoryChanges('backend/')) {
            sh "chmod +x jenkins/scripts/backend_build.sh"
        }
    }

    stage("Build frontend") {
        if (checkDirectoryChanges('frontend/')) {
            sh "chmod +x jenkins/scripts/frontend_build.sh"
        }
    }
}
